rule tune:
    input:
        x_train = f"{config['workdir']}/results/split_data/x_train.csv.zip",
        y_train = f"{config['workdir']}/results/split_data/y_train.csv.zip"
    output:
        best_parameters = "results/{model}/{classifier}/tuned_parameters.yml"
    params:
        classifier = "{classifier}",
        model = "{model}",
        random_state = config["random_state"],
        config_path = config["workdir"],
        config = "{classifier}",
    conda:
        "../envs/hydra.yml"
    threads:
        config["threads"]
    shell:
        """
        # Update x_train path
        sed -i \
        's?      x_train: choice.*?      x_train: choice("{input.x_train}")?' \
        {params.config_path}/configs/{params.config}.yaml
        
        # Update y_train path
        sed -i \
        's?      y_train: choice.*?      y_train: choice("{input.y_train}")?' \
        {params.config_path}/configs/{params.config}.yaml
        
        python scripts/tune.py \
        --config-name {params.config} \
        --multirun
        # --cfg hydra -p hydra.launcher
        # --trained-model {output.best_parameters} \
        # --classifier {params.classifier} \
        # --model {params.model} \
        # --random-state {params.random_state}
        """
